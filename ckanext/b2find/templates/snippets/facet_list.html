
{% set active = true in (items or h.get_facet_items_dict(name))|map(attribute='active') %}
{% set facet_id = title|lower %}

{% block facet_list_heading %}
  {% set title = title or h.get_facet_title(name) %}
  <h2 class="module-heading accordion-toggle{% if not active %} collapsed{% endif %}" data-toggle="collapse" data-target="#facet_{{ facet_id }}">
    <i class="icon-medium icon-filter"></i>
    {{ title }}
    <i class="icon-medium icon-chevron pull-right"></i>
  </h2>
{% endblock %}

{% block facet_list_items %}
  {% with items = items or h.get_facet_items_dict(name) %}
  <div id="facet_{{ facet_id }}" class="collapse{% if active %} in{% endif %}">
  {% if items %}
    <input type="text" placeholder="Filter" ng-model="search_{{ facet_id }}"/>
    <nav>
      <ul class="{{ nav_class or 'unstyled nav nav-simple nav-facet' }}" ng-init='items=[
        {% for item in items %}
          {% set href = h.remove_url_param(name, item.name, extras=extras, alternative_url=alternative_url) if item.active else h.add_url_param(new_params={name: item.name}, extras=extras, alternative_url=alternative_url) %}
          {% set label = label_function(item) if label_function else item.display_name %}
          {% set label_truncated = h.truncate(label, 22) if not label_function else label %}
          {% set count = count_label(item['count']) if count_label else ('(%d)' % item['count']) %}
          {
            href: "{{ href }}",
            label: "{{ label }}",
            label_truncated: "{{ label_truncated }}",
            count: "{{ item.count }}",
            active:"{{ item.active|lower }}"
          },
        {% endfor %}
        ]'>
        <li class="{{ nav_item_class or 'nav-item' }}"
            ng-repeat="item in items | filter:{label:search_{{ facet_id }}}"
          {% raw %}
            ng-class="{active: {{item.active}}}">
            <a href="{{ item.href }}" title="{{ item.label }}">
              <span>{{ item.label_truncated }} ({{ item.count }})</span>
            </a>
          {% endraw %}
        </li>
      </ul>
    </nav>

    <p class="module-footer">
      {% if h.get_param_int('_%s_limit' % name) %}
        {% if h.has_more_facets(name) %}
          <a href="{{ h.remove_url_param('_%s_limit' % name, replace=0, extras=extras, alternative_url=alternative_url) }}" class="read-more">{{ _('Show More {facet_type}').format(facet_type=title) }}</a>
        {% endif %}
      {% else %}
        <a href="{{ h.remove_url_param('_%s_limit' % name, extras=extras, alternative_url=alternative_url) }}" class="read-more">{{ _('Show Only Popular {facet_type}').format(facet_type=title) }}</a>
      {% endif %}
    </p>
  {% else %}
    <p class="module-content empty">{{ _('There are no {facet_type} that match this search').format(facet_type=title) }}</p>
  {% endif %}
  </div>
  {% endwith %}
{% endblock %}
